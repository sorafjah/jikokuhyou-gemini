<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>時刻表問題</title>
    <style>
        /* 印刷・画面共通の基本設定 */
        :root {
            --text-color: #000000;
            --bg-color: #ffffff;
            --gray-light: #e0e0e0;
            --border-color: #000000;
        }

        body {
            /* 読みやすいUDフォントを最優先、なければ游ゴシック */
            font-family: "BIZ UDPGothic", "BIZ UDPゴシック", "Yu Gothic", "游ゴシック", sans-serif;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            font-size: 14pt;
        }

        /* 印刷設定: A4一枚に収める、グレースケール */
        @media print {
            .no-print { display: none !important; }
            body { padding: 0; font-size: 12pt; }
            @page { size: A4 portrait; margin: 15mm; }
            .container { border: none !important; padding: 0 !important; }
            /* 印刷時に要素がページをまたがないようにする */
            .question-area { page-break-inside: avoid; }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            border: 1px solid var(--border-color);
            padding: 30px;
            box-sizing: border-box;
        }

        h1 {
            font-size: 18pt;
            text-align: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 0;
            letter-spacing: 2px;
        }

        .name-field {
            text-align: right;
            margin-bottom: 20px;
            font-size: 14pt;
        }
        .name-field span {
            border-bottom: 1px solid var(--border-color);
            display: inline-block;
            width: 200px;
            height: 1.2em;
        }

        /* 数字と特定の記号を大きくする設定 */
        .num-symbol {
            font-size: 1.3em;
            font-weight: bold;
            font-family: "Arial", sans-serif; /* 数字をはっきりさせるため */
        }

        /* 時刻表のスタイル */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            margin-bottom: 25px;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid var(--border-color);
            text-align: center;
            padding: 4px;
        }
        th {
            background-color: var(--gray-light);
            font-weight: normal;
        }
        .hour {
            font-weight: bold;
            width: 50px;
            font-size: 1.2em;
        }
        .minutes {
            text-align: left;
            padding-left: 15px;
            letter-spacing: 5px;
            font-size: 1.1em;
        }

        /* 問題文エリア */
        .question-area {
            margin-top: 20px;
            padding: 20px;
            border: 2px solid var(--border-color);
        }
        .question-text {
            margin-bottom: 20px;
            margin-left: 25px;
            text-indent: -25px; /* 記号のぶら下げインデント */
        }
        .sub-question {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        /* 解答欄 */
        .answer-area {
            text-align: right;
            margin-top: 30px;
            padding-right: 20px;
        }
        .answer-line {
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        /* 設定パネル（印刷時は消える） */
        .config-panel {
            background: #f8f8f8;
            padding: 15px 20px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12pt;
        }
        .config-panel select, .config-panel button {
            font-size: 11pt;
            padding: 4px 8px;
            margin-right: 15px;
            margin-bottom: 10px;
        }
        .config-panel button {
            cursor: pointer;
            background-color: #fff;
            border: 1px solid #333;
        }
        .config-panel button:hover {
            background-color: #eee;
        }
    </style>
</head>
<body>

<div class="no-print config-panel">
    <strong style="display:block; margin-bottom:10px;">設定画面（印刷時には消えます）</strong>
    
    <label>間隔：
        <select id="intervalType">
            <option value="5">5分おき（均等）</option>
            <option value="1">1分単位（ランダム）</option>
        </select>
    </label>
    
    <label>出発の状況：
        <select id="startPos">
            <option value="random">ランダム</option>
            <option value="station">駅にいる</option>
            <option value="home">家にいる</option>
        </select>
    </label>

    <label>行き先：
        <select id="destination">
            <option value="random">ランダム</option>
            <option value="青空,あおぞら">青空駅</option>
            <option value="希望,きぼう">希望駅</option>
            <option value="未来,みらい">未来駅</option>
            <option value="桜町,さくらまち">桜町駅</option>
            <option value="朝日,あさひ">朝日駅</option>
        </select>
    </label>

    <label>所要時間：
        <select id="duration">
            <option value="random">ランダム</option>
            <option value="12">12分</option>
            <option value="18">18分</option>
            <option value="24">24分</option>
            <option value="35">35分</option>
        </select>
    </label>

    <div style="margin-top: 10px;">
        <button onclick="generateProblem()">新しい問題を作成</button>
        <button onclick="window.print()" style="font-weight: bold;">印刷する</button>
    </div>
</div>

<div class="container">
    <h1><ruby>時刻表<rt>じこくひょう</rt></ruby><ruby>問題<rt>もんだい</rt></ruby></h1>
    <div class="name-field"><ruby>名前<rt>なまえ</rt></ruby>：<span></span></div>

    <p><ruby>次<rt>つぎ</rt></ruby>の<ruby>時刻表<rt>じこくひょう</rt></ruby>を<ruby>見<rt>み</rt></ruby>て、<ruby>下<rt>した</rt></ruby>の<ruby>問題<rt>もんだい</rt></ruby>に<ruby>答<rt>こた</rt></ruby>えなさい。</p>
    
    <table id="timetable">
        <thead>
            <tr>
                <th class="hour"><ruby>時<rt>じ</rt></ruby></th>
                <th class="minutes"><ruby>分<rt>ふん</rt></ruby>（<span id="displayDestinationTable"></span> <ruby>行<rt>ゆ</rt></ruby>き）</th>
            </tr>
        </thead>
        <tbody id="timetableBody">
            <!-- JSで時刻表を生成 -->
        </tbody>
    </table>

    <div class="question-area">
        <div class="question-text">
            <span class="num-symbol">△</span> <ruby>問題<rt>もんだい</rt></ruby>：<br>
            <span id="qTextContext"></span>
        </div>
        
        <div class="sub-question">
            (<span class="num-symbol">1</span>) 一番<ruby>早<rt>はや</rt></ruby>く<ruby>乗<rt>の</rt></ruby>れる<ruby>電車<rt>でんしゃ</rt></ruby>は、<ruby>何時何分発<rt>なんじなんぷんはつ</rt></ruby>ですか。
        </div>
        <div class="sub-question" id="qTextArrival">
            <!-- JSで到着時刻を問う問題を生成 -->
        </div>

        <div class="answer-area">
            <div class="answer-line">
                <span class="num-symbol">▽</span> <ruby>答<rt>こた</rt></ruby>え (<span class="num-symbol">1</span>)：<u>　　<ruby>時<rt>じ</rt></ruby>　　<ruby>分<rt>ふん</rt></ruby></u>
            </div>
            <div class="answer-line">
                <span style="visibility: hidden;"><span class="num-symbol">▽</span> <ruby>答<rt>こた</rt></ruby>え</span> (<span class="num-symbol">2</span>)：<u>　　<ruby>時<rt>じ</rt></ruby>　　<ruby>分<rt>ふん</rt></ruby></u>
            </div>
        </div>
    </div>
</div>

<script>
// 時刻表データの保持用
let currentTimetable = {};

// ゼロ埋め関数
function padZero(num) {
    return num.toString().padStart(2, '0');
}

// 乱数生成関数（min以上max以下）
function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

// 時刻表の生成
function generateTimetable(isRandomMins) {
    const body = document.getElementById('timetableBody');
    body.innerHTML = '';
    currentTimetable = {};

    for (let h = 7; h <= 23; h++) {
        let mins = [];
        let count = 0;
        
        // 通勤時間帯（7-8時、17-19時）は本数を増やす
        if ((h >= 7 && h <= 8) || (h >= 17 && h <= 19)) {
            count = isRandomMins ? getRandomInt(7, 12) : 10; // ランダムまたは均等10本
        } else {
            count = isRandomMins ? getRandomInt(3, 6) : 4;  // ランダムまたは均等4本
        }

        if (isRandomMins) {
            // 1分単位ランダムの場合
            while (mins.length < count) {
                let m = getRandomInt(0, 59);
                if (!mins.includes(m)) mins.push(m);
            }
            mins.sort((a, b) => a - b);
        } else {
            // 5分おきなどの均等の場合（キリの良い数字にする）
            let step = Math.floor(60 / count);
            // 均等でも少し開始をずらすなどするとリアルだが、シンプルに0から
            for (let i = 0; i < count; i++) {
                // stepが15(4本), 6(10本)などになる。
                // 5の倍数に近づける処理
                let m = i * step;
                if(step === 6) m = i * 5; // 10本なら5分おき（0,5,10...45）
                mins.push(m);
            }
        }

        currentTimetable[h] = mins;
        
        const tr = document.createElement('tr');
        const minStr = mins.map(m => `<span class="num-symbol">${padZero(m)}</span>`).join('　');
        tr.innerHTML = `<td class="hour"><span class="num-symbol">${h}</span></td><td class="minutes">${minStr}</td>`;
        body.appendChild(tr);
    }
}

// 問題の生成
function generateProblem() {
    // 1. 設定の取得
    const isRandomMins = document.getElementById('intervalType').value === '1';
    let pos = document.getElementById('startPos').value;
    let destValue = document.getElementById('destination').value;
    let durationValue = document.getElementById('duration').value;

    // ランダム選択の処理
    if (pos === 'random') {
        pos = Math.random() < 0.5 ? 'station' : 'home';
    }
    
    let destName = "", destRuby = "";
    if (destValue === 'random') {
        const dests = [
            {name: "青空", ruby: "あおぞら"},
            {name: "希望", ruby: "きぼう"},
            {name: "未来", ruby: "みらい"},
            {name: "桜町", ruby: "さくらまち"},
            {name: "朝日", ruby: "あさひ"}
        ];
        const r = dests[getRandomInt(0, dests.length - 1)];
        destName = r.name;
        destRuby = r.ruby;
    } else {
        const parts = destValue.split(',');
        destName = parts[0];
        destRuby = parts[1];
    }

    let duration = 0;
    if (durationValue === 'random') {
        duration = getRandomInt(10, 45); // 10分〜45分の間
    } else {
        duration = parseInt(durationValue, 10);
    }

    // 2. 時刻表の描画
    generateTimetable(isRandomMins);

    // 行き先の表示更新
    document.getElementById('displayDestinationTable').innerHTML = `<ruby>${destName}<rt>${destRuby}</rt></ruby>駅`;

    // 3. 問題文に使う時刻の決定 (7時〜22時の間)
    const targetHour = getRandomInt(7, 22);
    const targetMin = getRandomInt(0, 59);

    // 4. 問題文テキストの組み立て
    let contextStr = "";
    if (pos === 'station') {
        contextStr = `いま、あなたは<ruby>駅<rt>えき</rt></ruby>にいます。<ruby>現在<rt>げんざい</rt></ruby>の<ruby>時刻<rt>じこく</rt></ruby>は <strong class="num-symbol">${targetHour}</strong><ruby>時<rt>じ</rt></ruby><strong class="num-symbol">${padZero(targetMin)}</strong><ruby>分<rt>ふん</rt></ruby> です。`;
    } else {
        const walkTime = getRandomInt(2, 5) * 5; // 10分, 15分, 20分, 25分
        contextStr = `あなたは<ruby>家<rt>いえ</rt></ruby>にいます。<ruby>駅<rt>えき</rt></ruby>から<ruby>家<rt>いえ</rt></ruby>までは<ruby>歩<rt>ある</rt></ruby>いて <strong class="num-symbol">${walkTime}</strong><ruby>分<rt>ふん</rt></ruby> かかります。<strong class="num-symbol">${targetHour}</strong><ruby>時<rt>じ</rt></ruby><strong class="num-symbol">${padZero(targetMin)}</strong><ruby>分<rt>ふん</rt></ruby> に<ruby>家<rt>いえ</rt></ruby>を<ruby>出<rt>で</rt></ruby>ました。`;
    }
    document.getElementById('qTextContext').innerHTML = contextStr;

    // (2) の問題文組み立て（所要時間の提示）
    const arrivalStr = `(<span class="num-symbol">2</span>) (<span class="num-symbol">1</span>)で<ruby>求<rt>もと</rt></ruby>めた<ruby>電車<rt>でんしゃ</rt></ruby>に<ruby>乗<rt>の</rt></ruby>ると、<ruby>${destName}<rt>${destRuby}</rt></ruby><ruby>駅<rt>えき</rt></ruby>には<ruby>何時何分<rt>なんじなんぷん</rt></ruby>に<ruby>到着<rt>とうちゃく</rt></ruby>しますか。<br>
    　　（<ruby>電車<rt>でんしゃ</rt></ruby>の<ruby>所要時間<rt>しょようじかん</rt></ruby>は <strong class="num-symbol">${duration}</strong><ruby>分<rt>ふん</rt></ruby> とします）`;
    
    document.getElementById('qTextArrival').innerHTML = arrivalStr;

    /* * ※自動解答計算ロジック（今後の機能拡張やコンソール確認用）
     * 実際にプリントに解答を印字する機能を追加したい場合は、
     * ここで計算した結果を非表示要素などに出力します。
     */
    let readyHour = targetHour;
    let readyMin = targetMin;
    if (pos === 'home') {
        // 家を出る時間 + 徒歩時間 = 駅に着く時間
        readyMin += 15; // 仮置きではなく実際のwalkTimeを加算する場合は変数スコープを調整
        // 簡単のためここでは計算処理のみ記述し、画面には出しません。
    }
}

// ページ読み込み時に1回実行
window.onload = generateProblem;
</script>

</body>
</html>
